function sendcode(){var o=document.getElementById("sendcode_button"),e=document.getElementById("username").value;if(/^1[3-9]\d{9}$/.test(e.trim())){let t=document.getElementById("sendcode_button");t.textContent="发送中...",t.disabled=!0,fetch("/sendcode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})}).then(e=>{e.json().then(n=>{if(200===e.status){console.log("Success:",n);document.getElementById("sendcode_button");let e=58,t=setInterval(()=>{0<--e?o.textContent=e+"s":(clearInterval(t),o.disabled=!1,o.textContent="发送验证码")},1e3)}else console.error("Error:",e),t.textContent="发送验证码",t.disabled=!1;alert(n.msg)})}).catch(e=>{console.error("网络错误或其他错误:",e),t.textContent="发送验证码",t.disabled=!1,alert("验证码请求失败，可能网络错误，请重试或联系管理员。",e)})}else alert("请输入正确的手机号！")}function verifycode(){var s=document.getElementById("username").value,e=document.getElementById("code").value,t={username:s,code:e};""==s||""==e?alert("账号验证码不能为空"):/^\d{6}$/.test(e)?((e=document.getElementById("login_button")).textContent="登录中...",e.disabled=!0,fetch("/verifycode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(d=>{d.json().then(e=>{var t,n,o;200===d.status?"code_error"===e.status?alert(e.msg):"login_success"===e.status&&(console.log("Success:",e),document.getElementById("login_form").style.display="none",document.getElementById("qrcode_form").style.display="flex",(o=document.getElementById("submit_info")).textContent="提交信息",o.disabled=!1,alert(e.msg),o=e.password,t=e.remarks,n=e.uid,document.getElementById("jd_username").value=s||"",document.getElementById("password").value=o||"",document.getElementById("remark").value=t||"",document.getElementById("uid").value=n||"",postqrcode(s)):((o=document.getElementById("login_button")).textContent="登录",o.disabled=!1,console.error("Error:",d),alert(e.msg))})}).catch(e=>{console.error("登录请求失败，可能网络错误，请重试或联系管理员。",e),alert("登录请求失败，可能网络错误，请重试或联系管理员。",e);e=document.getElementById("login_button");e.textContent="登录",e.disabled=!1})):alert("验证码必须是6位数字")}function submitinfo(){var t=document.getElementById("jd_username").value,o=document.getElementById("password").value,d=document.getElementById("remark").value,s=document.getElementById("uid").value;if(""==t||""==o||""==d)alert("账号&密码&备注-不能为空");else if(20<t.length||30<o.length||30<d.length||100<s.length)alert("账号or密码or备注orUID超过字符");else{let e={username:t,password:o,remark:d,uid:s},n=document.getElementById("submit_info");n.textContent="提交中...",n.disabled=!0,fetch("/submit_user_info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(t=>{t.json().then(e=>{200===t.status?(console.log("Success:",e),document.getElementById("info_form").style.display="none"):(console.error("Error:",t),n.textContent="提交信息",n.disabled=!1),alert(e.msg)})}).catch(e=>{console.error("网络错误或其他错误:",e),alert("验证码请求失败，可能网络错误，请重试或联系管理员。",e),n.textContent="提交信息",n.disabled=!1})}}function postqrcode(e){fetch("/wxpusher_apptoken",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})}).then(t=>{t.json().then(e=>{200===t.status?(console.log("Success:",e),document.getElementById("qrcode").src=e.data.shortUrl):(console.error("Error:",t),alert("UID二维码请求出错，请联系管理员处理"))})}).catch(e=>{console.error("网络错误或其他错误:",e),alert("UID二维码请求出错，请联系管理员处理")})}